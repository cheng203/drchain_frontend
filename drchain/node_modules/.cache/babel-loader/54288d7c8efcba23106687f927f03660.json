{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* eslint react/no-is-mounted:0 react/sort-comp:0 */\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\n\nvar AjaxUploader = function (_Component) {\n  _inherits(AjaxUploader, _Component);\n\n  function AjaxUploader() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, AjaxUploader);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = AjaxUploader.__proto__ || Object.getPrototypeOf(AjaxUploader)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\n      uid: getUid()\n    }, _this.reqs = {}, _this.onChange = function (e) {\n      var files = e.target.files;\n\n      _this.uploadFiles(files);\n\n      _this.reset();\n    }, _this.onClick = function () {\n      var el = _this.fileInput;\n\n      if (!el) {\n        return;\n      }\n\n      el.click();\n    }, _this.onKeyDown = function (e) {\n      if (e.key === 'Enter') {\n        _this.onClick();\n      }\n    }, _this.onFileDrop = function (e) {\n      if (e.type === 'dragover') {\n        e.preventDefault();\n        return;\n      }\n\n      var files = Array.prototype.slice.call(e.dataTransfer.files).filter(function (file) {\n        return attrAccept(file, _this.props.accept);\n      });\n\n      _this.uploadFiles(files);\n\n      e.preventDefault();\n    }, _this.saveFileInput = function (node) {\n      _this.fileInput = node;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(AjaxUploader, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._isMounted = true;\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n      this.abort();\n    }\n  }, {\n    key: 'uploadFiles',\n    value: function uploadFiles(files) {\n      var _this2 = this;\n\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.forEach(function (file) {\n        file.uid = getUid();\n\n        _this2.upload(file, postFiles);\n      });\n    }\n  }, {\n    key: 'upload',\n    value: function upload(file, fileList) {\n      var _this3 = this;\n\n      var props = this.props;\n\n      if (!props.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n\n      var before = props.beforeUpload(file, fileList);\n\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            _this3.post(processedFile);\n          } else {\n            _this3.post(file);\n          }\n        })['catch'](function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n    }\n  }, {\n    key: 'post',\n    value: function post(file) {\n      var _this4 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n\n      var props = this.props;\n      var data = props.data;\n      var onStart = props.onStart,\n          onProgress = props.onProgress;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n\n      var uid = file.uid;\n      var request = props.customRequest || defaultRequest;\n      this.reqs[uid] = request({\n        action: props.action,\n        filename: props.name,\n        file: file,\n        data: data,\n        headers: props.headers,\n        withCredentials: props.withCredentials,\n        onProgress: onProgress ? function (e) {\n          onProgress(e, file);\n        } : null,\n        onSuccess: function onSuccess(ret, xhr) {\n          delete _this4.reqs[uid];\n          props.onSuccess(ret, file, xhr);\n        },\n        onError: function onError(err, ret) {\n          delete _this4.reqs[uid];\n          props.onError(err, ret, file);\n        }\n      });\n      onStart(file);\n    }\n  }, {\n    key: 'reset',\n    value: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    }\n  }, {\n    key: 'abort',\n    value: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (reqs[uid]) {\n          reqs[uid].abort();\n          delete reqs[uid];\n        }\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid]) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames;\n\n      var _props = this.props,\n          Tag = _props.component,\n          prefixCls = _props.prefixCls,\n          className = _props.className,\n          disabled = _props.disabled,\n          style = _props.style,\n          multiple = _props.multiple,\n          accept = _props.accept,\n          children = _props.children;\n      var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n      var events = disabled ? {} : {\n        onClick: this.onClick,\n        onKeyDown: this.onKeyDown,\n        onDrop: this.onFileDrop,\n        onDragOver: this.onFileDrop,\n        tabIndex: '0'\n      };\n      return React.createElement(Tag, _extends({}, events, {\n        className: cls,\n        role: 'button',\n        style: style\n      }), React.createElement('input', {\n        type: 'file',\n        ref: this.saveFileInput,\n        key: this.state.uid,\n        style: {\n          display: 'none'\n        },\n        accept: accept,\n        multiple: multiple,\n        onChange: this.onChange\n      }), children);\n    }\n  }]);\n\n  return AjaxUploader;\n}(Component);\n\nAjaxUploader.propTypes = {\n  component: PropTypes.string,\n  style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  className: PropTypes.string,\n  multiple: PropTypes.bool,\n  disabled: PropTypes.bool,\n  accept: PropTypes.string,\n  children: PropTypes.any,\n  onStart: PropTypes.func,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  headers: PropTypes.object,\n  beforeUpload: PropTypes.func,\n  customRequest: PropTypes.func,\n  onProgress: PropTypes.func,\n  withCredentials: PropTypes.bool\n};\nexport default AjaxUploader;","map":{"version":3,"sources":["/Users/administrator/Desktop/DrChain/drchain_frontend/drchain/node_modules/rc-upload/es/AjaxUploader.js"],"names":["_extends","_defineProperty","_classCallCheck","_createClass","_possibleConstructorReturn","_inherits","React","Component","PropTypes","classNames","defaultRequest","getUid","attrAccept","AjaxUploader","_Component","_ref","_temp","_this","_ret","_len","arguments","length","args","Array","_key","__proto__","Object","getPrototypeOf","call","apply","concat","state","uid","reqs","onChange","e","files","target","uploadFiles","reset","onClick","el","fileInput","click","onKeyDown","key","onFileDrop","type","preventDefault","prototype","slice","dataTransfer","filter","file","props","accept","saveFileInput","node","value","componentDidMount","_isMounted","componentWillUnmount","abort","_this2","postFiles","forEach","upload","fileList","_this3","beforeUpload","setTimeout","post","before","then","processedFile","processedFileType","toString","console","log","_this4","data","onStart","onProgress","request","customRequest","action","filename","name","headers","withCredentials","onSuccess","ret","xhr","onError","err","setState","keys","render","_classNames","_props","Tag","component","prefixCls","className","disabled","style","multiple","children","cls","events","onDrop","onDragOver","tabIndex","createElement","role","ref","display","propTypes","string","object","bool","any","func","oneOfType"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* eslint react/no-is-mounted:0 react/sort-comp:0 */\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport defaultRequest from './request';\nimport getUid from './uid';\nimport attrAccept from './attr-accept';\n\nvar AjaxUploader = function (_Component) {\n  _inherits(AjaxUploader, _Component);\n\n  function AjaxUploader() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, AjaxUploader);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = AjaxUploader.__proto__ || Object.getPrototypeOf(AjaxUploader)).call.apply(_ref, [this].concat(args))), _this), _this.state = { uid: getUid() }, _this.reqs = {}, _this.onChange = function (e) {\n      var files = e.target.files;\n      _this.uploadFiles(files);\n      _this.reset();\n    }, _this.onClick = function () {\n      var el = _this.fileInput;\n      if (!el) {\n        return;\n      }\n      el.click();\n    }, _this.onKeyDown = function (e) {\n      if (e.key === 'Enter') {\n        _this.onClick();\n      }\n    }, _this.onFileDrop = function (e) {\n      if (e.type === 'dragover') {\n        e.preventDefault();\n        return;\n      }\n      var files = Array.prototype.slice.call(e.dataTransfer.files).filter(function (file) {\n        return attrAccept(file, _this.props.accept);\n      });\n      _this.uploadFiles(files);\n\n      e.preventDefault();\n    }, _this.saveFileInput = function (node) {\n      _this.fileInput = node;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(AjaxUploader, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._isMounted = true;\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n      this.abort();\n    }\n  }, {\n    key: 'uploadFiles',\n    value: function uploadFiles(files) {\n      var _this2 = this;\n\n      var postFiles = Array.prototype.slice.call(files);\n      postFiles.forEach(function (file) {\n        file.uid = getUid();\n        _this2.upload(file, postFiles);\n      });\n    }\n  }, {\n    key: 'upload',\n    value: function upload(file, fileList) {\n      var _this3 = this;\n\n      var props = this.props;\n\n      if (!props.beforeUpload) {\n        // always async in case use react state to keep fileList\n        return setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n\n      var before = props.beforeUpload(file, fileList);\n      if (before && before.then) {\n        before.then(function (processedFile) {\n          var processedFileType = Object.prototype.toString.call(processedFile);\n          if (processedFileType === '[object File]' || processedFileType === '[object Blob]') {\n            _this3.post(processedFile);\n          } else {\n            _this3.post(file);\n          }\n        })['catch'](function (e) {\n          console && console.log(e); // eslint-disable-line\n        });\n      } else if (before !== false) {\n        setTimeout(function () {\n          return _this3.post(file);\n        }, 0);\n      }\n    }\n  }, {\n    key: 'post',\n    value: function post(file) {\n      var _this4 = this;\n\n      if (!this._isMounted) {\n        return;\n      }\n      var props = this.props;\n      var data = props.data;\n      var onStart = props.onStart,\n          onProgress = props.onProgress;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n      var uid = file.uid;\n\n      var request = props.customRequest || defaultRequest;\n      this.reqs[uid] = request({\n        action: props.action,\n        filename: props.name,\n        file: file,\n        data: data,\n        headers: props.headers,\n        withCredentials: props.withCredentials,\n        onProgress: onProgress ? function (e) {\n          onProgress(e, file);\n        } : null,\n        onSuccess: function onSuccess(ret, xhr) {\n          delete _this4.reqs[uid];\n          props.onSuccess(ret, file, xhr);\n        },\n        onError: function onError(err, ret) {\n          delete _this4.reqs[uid];\n          props.onError(err, ret, file);\n        }\n      });\n      onStart(file);\n    }\n  }, {\n    key: 'reset',\n    value: function reset() {\n      this.setState({\n        uid: getUid()\n      });\n    }\n  }, {\n    key: 'abort',\n    value: function abort(file) {\n      var reqs = this.reqs;\n\n      if (file) {\n        var uid = file;\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n        if (reqs[uid]) {\n          reqs[uid].abort();\n          delete reqs[uid];\n        }\n      } else {\n        Object.keys(reqs).forEach(function (uid) {\n          if (reqs[uid]) {\n            reqs[uid].abort();\n          }\n\n          delete reqs[uid];\n        });\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames;\n\n      var _props = this.props,\n          Tag = _props.component,\n          prefixCls = _props.prefixCls,\n          className = _props.className,\n          disabled = _props.disabled,\n          style = _props.style,\n          multiple = _props.multiple,\n          accept = _props.accept,\n          children = _props.children;\n\n      var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n      var events = disabled ? {} : {\n        onClick: this.onClick,\n        onKeyDown: this.onKeyDown,\n        onDrop: this.onFileDrop,\n        onDragOver: this.onFileDrop,\n        tabIndex: '0'\n      };\n      return React.createElement(\n        Tag,\n        _extends({}, events, {\n          className: cls,\n          role: 'button',\n          style: style\n        }),\n        React.createElement('input', {\n          type: 'file',\n          ref: this.saveFileInput,\n          key: this.state.uid,\n          style: { display: 'none' },\n          accept: accept,\n          multiple: multiple,\n          onChange: this.onChange\n        }),\n        children\n      );\n    }\n  }]);\n\n  return AjaxUploader;\n}(Component);\n\nAjaxUploader.propTypes = {\n  component: PropTypes.string,\n  style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  className: PropTypes.string,\n  multiple: PropTypes.bool,\n  disabled: PropTypes.bool,\n  accept: PropTypes.string,\n  children: PropTypes.any,\n  onStart: PropTypes.func,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  headers: PropTypes.object,\n  beforeUpload: PropTypes.func,\n  customRequest: PropTypes.func,\n  onProgress: PropTypes.func,\n  withCredentials: PropTypes.bool\n};\n\n\nexport default AjaxUploader;"]},"metadata":{},"sourceType":"module"}